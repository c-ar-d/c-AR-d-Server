language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '9.6' # highest available postgres version on Travis
dist: trusty # uses trusty environment
sudo: false # when on trusty, uses Docker containers for speed
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "c-ar-d-server-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)
script:
  - npm test             # test the code
  # - npm run build-client # make the bundle

before_deploy:
  - rm -rf node_modules # omit from the tarball, since we skip cleanup
deploy:
  skip_cleanup: true # prevents travis from deleting the build
  provider: heroku
  app: c-ar-d-server # see README
  api_key:
    secure: g9icidaLIEcDyCBVqW3uGm276wm0uLcv9Db6Lxi4s8TJQOytSbopdeqp6NeFLk3PQicnFQITXfL4Pp1Jn2prZCBmycVbbWm/AlzC6vRwEoabyCrMflriCSxuCUYPwu//0XZxwD+5D9bJdV/X7Tu+VhKSi63+JViLy7zDfTAscsWs5WRh6q769Y+f4AVnYQfNfpPW8HW7XU14T3QPFtf9D/ue458Jaqp7r7vd1U7wkEIBfpjcoCO8yViidVq+Clnc/qQI62SZAjboZapqBudElFbre8tfGnD9g/jGdBk0rz6eCvbyE/JlUOhksd3ko3JTFU+2bW1fiydVtdIo9qO/6aW/JmiG7P8jZzKw46JOHkExO8FomzcUuhevZq/Ddo8VRxw5ZA36y0zbOzoeDijQ8ePrwmRPdb18TYEeDeeLDvrakov6POSgUUP0fURUaXCcnEuim6crCHxljJD5/E6mPNt4tK9A7w888QlQuvMWu2oqB5TNkTEfOokGtadsFvB8lyFqhGDM06YBati04eBaAfRYK2aB05wc6CLa1CMWOCpTJQah4L7rXWVJNdnxAGfqwlNFaxD392DE2vZ3fN/7WlKpNkpKiHBG1kXCL0flXGiKSEqkAsWCO0nnuOq1LWuyInPbqVCvG/sRZfr4/JFMgNPbS/P5UDt3Xuy7rwUZwiI=
