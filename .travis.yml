language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '9.6' # highest available postgres version on Travis
dist: trusty # uses trusty environment
sudo: false # when on trusty, uses Docker containers for speed
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "c-ar-d-server-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)
script:
  - npm test             # test the code
  - npm run build-client # make the bundle

before_deploy:
  - rm -rf node_modules # omit from the tarball, since we skip cleanup
deploy:
  skip_cleanup: true # prevents travis from deleting the build
  provider: heroku
  app: c-ar-d-server # see README
  api_key:
    secure: "cApy+sKAOS9qiZZgQcOnNg7u3NbHjNmn6vCsCi8xAKQG6Ysk3tkmeTj5uUVvtw/JOdobGIAdGLdD+GqVMWsAGoi5XeFDtyEjL9ldjy1G0NTk8JSmzkn7U/k7AzcHpZubtzH89B8GBzEoTtW//41C1hTPvLL7obiqr8uBxNDkotrAojIzGfKdorAuAQh5oeu8ApB5Ujd/sRwNnDpeicRFqsmGGatjVtNjBzB9Jh+jc9TKqm/SJS8mMQQ1jydBvBgLFB2vnk1FfiYIQoUPWWYNRjfXTajS2m7F63IIux8SueNMHWUaAefUA54Vn2TqcesTCHk5IKY3Q4TXfU+EZQIvs+dO45AbsXh0HWSvbGklE6uNBn2qCTabvmSMpoGHvtuNQUcyDOZgRqJJAPaSsIwDsR1zVfR7OUoBQBTkSTQxsF2zg/P+XLu27BFMjm/aE6IzrJXyG+vIkx43wZSQEx9nVqkHNQHG+wVwGlJF3hnOGhaw6tAySB9Lp4zPma7MyzyeWj80CyrJIIeXRlLXbZaJ+FF1bJERyVFvbb5fbpgjTijeK8dLZYsyIi8vpWVZ9lrovFC8NF0rEvITT+bphwuIXDN8ax5T/FlOjpcPRweL3apu1QXETJl/4f8xECEx+2FyPdWDYKAjEp3EcvdQf4UNVDFPqvXgUx7U6jy6HFcpMD8="
